<!doctype html><html lang=zh-cn dir=content/zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests">
<title> ygopro源码分析 - rayrain's blog </title>
<meta name=keywords content="righteoux">
<meta name=author content="rayrain">
<meta property="og:title" content="ygopro源码分析">
<meta property="og:site_name" content="rayrain's blog">
<meta property="og:image" content="/img/author.jpg">
<meta name=title content="ygopro源码分析 - rayrain's blog">
<meta name=description content="about ygopro">
<link rel="shortcut icon" href=/img/favicon.ico>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css>
<link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet type=text/css>
<link href=/css/syntax.css rel=stylesheet type=text/css>
</head>
<body itemscope itemtype=http://schema.org/WebPage lang=zh-hans>
<div class="container one-collumn sidebar-position-left page-home">
<div class=headband></div>
<header id=header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner> <div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle role=button style=opacity:1;top:0>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<div class=multi-lang-switch>
<i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-cn href=#>中文</a>
</div>
<div class=custom-logo-site-title>
<a href=/ class=brand rel=start>
<span class=logo-line-before><i></i></span>
<span class=site-title>rayrain's blog</span>
<span class=logo-line-after><i></i></span>
</a>
</div>
<p class=site-subtitle></p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger" style=opacity:1;top:0>
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul id=menu class=menu>
<li class=menu-item>
<a href=/ rel=section>
<i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页
</a>
</li>
<li class=menu-item>
<a href=/post rel=section>
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档
</a>
</li>
<li class=menu-item>
<a href=/about.html rel=section>
<i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于我
</a>
</li>
<li class=menu-item>
<a href=/404.html rel=section>
<i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>公益404
</a>
</li>
<li class="menu-item menu-item-search">
<a href=javascript:; class=popup-trigger> <i class="menu-item-icon fa fa-search fa-fw"></i> <br> 搜索</a>
</li>
</ul>
<div class=site-search>
<div class="popup search-popup local-search-popup">
<div class="local-search-header clearfix">
<span class=search-icon><i class="fa fa-search"></i> </span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span>
<div class=local-search-input-wrapper>
<input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off>
</div>
</div>
<div id=local-search-result></div>
</div>
</div>
</nav>
</div>
</header>
<main id=main class=main>
<div class=main-inner>
<div class=content-wrap>
<div id=content class=content>
<section id=posts class=posts-expand>
<article class="post post-type-normal" itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">
<a class=post-title-link href=http://rayrain.xyz/ygopro/ itemprop=url>
ygopro源码分析
</a>
</h1>
<div class=post-meta>
<span class=post-time>
<i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2021-12-28">
2021-12-28
</time>
</span>
<span>
|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>4105 字</span>
</span>
<span>
|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>9分钟</span>
</span>
<span id=/ygopro/ class=leancloud_visitors data-flag-title=ygopro源码分析>
|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span>
</span>
</div>
</header>
<div class=post-body itemprop=articleBody>
<h1 id=总览>总览</h1>
<h2 id=1简单介绍>1.简单介绍</h2>
<p><a href=https://github.com/Fluorohydride/ygopro>ygopro</a>是一个开源免费的游戏王模拟器,可以模拟几乎所有的游戏王卡片,并且在源码的级别上同时支持windows linux 和macos等操作系统,不过这个项目的创建者Fluorohydride(圆神)从2016年就神隠了,这个项目由一群爱好者一直维护,还有两个主要的对战服务器,233服和萌卡mycard.</p>
<p>本文的读者想必都是决斗者了,一些专有名词就不解释了,默认大家都懂了.</p>
<p>源码由3部分组成,还用了若干的第三方库.</p>
<pre><code>ygopro:游戏的客户端本体
        |-irrlicht:游戏引擎,负责游戏画面和GUI
        |-freetype:字体引擎,负责让irrlicht显示中文
        |-sqlite3:轻量级数据库,存储卡片的数据,用于卡片的查找搜寻
        |-libevent2:网络库,实现联机对战
        |-lzma:压缩算法,用于游戏录像
ocgcore:脚本处理引擎
        |-lua5.3:用于读取各种脚本
script:lua编写的卡片脚本
</code></pre>
<ul>
<li>
<p>ygopro使用的音频引擎是irrKlang,不开源,我直接选择性忽略了.</p>
</li>
<li>
<p>我全程在archlinux上分析的源码,文中有关windows的地方我都验证过了</p>
</li>
<li>
<p>不会分析TAG模式和replay</p>
</li>
</ul>
<h2 id=2前期准备>2.前期准备</h2>
<h3 id=21-下载源码>2.1 下载源码</h3>
<pre><code>git clone --recurse https://github.com/Fluorohydride/ygopro.git
</code></pre>
<p>这个命令可以源码的3部分全部下载下来.不包括第三方库.</p>
<p>然后就是编译了,打开文件夹后可以看到本项目似乎支持cmake和premake4.</p>
<p>实际上这个CMakeList文件的编写者是在ubuntu系linux下测试的,如果你使用ubuntu系的linux的话,安装好各种库之后就可以用cmake一键编译了,如果不是的话就往下看吧.</p>
<h3 id=22-使用visualstudio编译>2.2 使用VisualStudio编译</h3>
<p>我不太喜欢这个重量级的软件,如果想要用vs编译的话,建议去参考<a href=https://github.com/mercury233/ygopro/blob/test/.travis.yml>尸体233的Travis CI脚本</a>,按照这个脚本一步步操作,可以生成sln项目文件,然后就能用vs编译了,下面的内容就可以直接跳过去了,直接去看第3节了.</p>
<h3 id=23-使用vcpkg管理第三方库>2.3 使用vcpkg管理第三方库</h3>
<p>如果你按照上面的操作使用vs编译的话,你需要下载一堆第三方库的源码,然后解压到指定目录,特别麻烦,而且这些库是"一次性"的,所以我推荐使用vcpkg去统一管理这些第三方库,具体使用方法我就不多说了,<del>懂得都懂</del>,<a href=https://github.com/microsoft/vcpkg/blob/master/README_zh_CN.md>官方文档</a>.</p>
<blockquote>
<p>我用的linux,自带包管理工具,也需要用vcpkg吗?</p>
</blockquote>
<p>如果使用的是非ubuntu系的话,还是建议使用,因为vcpkg可以完美嵌入cmake,如果使用的是自带的包管理工具的话,可能cmake无法find到某个库,头文件路径也可能跟代码有出入,用了vcpkg,<del>这一切就都解决了</del>.</p>
<h3 id=24-使用vscode>2.4 使用vscode</h3>
<p>如果没有选择vs的话,vscode就是最佳选择了,话是这么说,但vs改装还得装,因为编译器msvc是必须的.
需要的vscode插件:C/C++ ,CMake 和CMake Tools.</p>
<blockquote>
<p>关于CLion</p>
</blockquote>
<p>我使用过一段时间的CLion,它的体验基本上跟vscode一致,但存在一些缺点:</p>
<ul>
<li>占用资源比较大</li>
<li>多线程调试很差,甚至不如直接用gdb.(这是我遇到的问题,我没找到原因)</li>
</ul>
<h3 id=25-linux上使用cmakegcc编译>2.5 linux上使用cmake+gcc编译</h3>
<p>如上面所说,使用vcpkg管理第三方库,嵌入项目自带的CMakeLists文件即可.</p>
<p>具体做法:将原本的第三方库相关内容去掉换成vcpkg</p>
<h3 id=26-windows上使用cmakemsvc编译>2.6 windows上使用cmake+msvc编译</h3>
<h3 id=杂项>杂项</h3>
<blockquote>
<p>游戏配置的读取
ygopro所有的游戏配置都写在文本文件里</p>
</blockquote>
<ul>
<li>lflist.conf 禁卡表文件,包含了所有的禁卡表</li>
<li>strings.conf 在客户端上显示的所有文字</li>
<li>system.conf 一些设置选项</li>
</ul>
<h3 id=irrlicht>irrlicht</h3>
<p>irrlicht是一个古老的游戏引擎,网上几乎没有什么中文资料,不过对于ygopro来说,只用了一些简单的图形效果和很复古的GUI,比如下面的程序通过改变卡片的横坐标来表示卡组的洗牌动画</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>for (auto cit = mainGame-&gt;dField.deck[player].begin(); cit != mainGame-&gt;dField.deck[player].end(); ++cit) {
					(*cit)-&gt;dPos = irr::core::vector3df(rnd.rand() * 0.4f / rnd.rand_max - 0.2f, 0, 0);
					(*cit)-&gt;dRot = irr::core::vector3df(0, 0, 0);
					(*cit)-&gt;is_moving = true;
					(*cit)-&gt;aniFrame = 3;
				}
</code></pre></div><p>想学习irrlicht的话建议去看官方的<a href="https://irrlicht.sourceforge.io/?page_id=291">Tutorials</a>.</p>
<p>irrlicht写的非常规范,容易阅读,但毕竟十几年前的产物了,并不推荐用这个制作游戏.</p>
<ul>
<li>I 开头的是 纯虚接口类</li>
<li>C 开头的是 接口实现类</li>
<li>E 是枚举值</li>
<li>S 是结构体</li>
</ul>
<p>irrlichtr是个3D引擎,想深入学习需要OpenGL或者Direct3D相关的知识.</p>
<p>但是对于ygopro来说,只需要了解下面这两点就可以了</p>
<blockquote>
<p>1.irrlicht的初始化操作</p>
</blockquote>
<p>首先需要获取一个<strong>IrrlichtDevice</strong>,这是irrlicht最根本的对象,有两种方法得到</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>自定义params,也是ygopro使用的方法
IrrlichtDevice* device;
irr::SIrrlichtCreationParameters params = irr::SIrrlichtCreationParameters(); 
//对params做一些自定义
device = irr::createDeviceEx(params);

或者 使用默认params
函数原型:	
IrrlichtDevice*  createDevice(
		video::E_DRIVER_TYPE deviceType = video::EDT_SOFTWARE,
		const core::dimension2d&lt;u32&gt;&amp; windowSize = (core::dimension2d&lt;u32&gt;(640,480)),
		u32 bits = 16,
		bool fullscreen = false,
		bool stencilbuffer = false,
		bool vsync = false,
		IEventReceiver* receiver = 0);
</code></pre></div><p><strong>使用IrrlichtDevice获取其他对象</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>获取IVideoDriver,所有图形相关的接口
IVideoDriver* driver = device-&gt;getVideoDriver();	

获取IGUIEnvironment,用于管理所有GUI组件
IGUIEnvironment* env = device-&gt;getGUIEnvironment();  

获取ISceneManager,管理camera 等其他资源
ISceneManager* smgr = device-&gt;getSceneManager();  
</code></pre></div><p><strong>主循环</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>while(device-&gt;run()) {

    //绘制GUI 绘制图形
    //接收玩家输入等
}
</code></pre></div><blockquote>
<p>2.GUI相关</p>
</blockquote>
<p>irrlicht的GUI还是比较落后的.ygopro用了七八百行,来添加GUI元素</p>
<p><strong>添加GUI的步骤</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>首先去要预先定义一些宏来表示GUI的id(类似QT里的信号),如:
#define BUTTON_LAN_MODE				100
#define BUTTON_SINGLE_MODE			101
#define BUTTON_REPLAY_MODE			102
#define BUTTON_TEST_MODE			103

添加btn
btnLanMode = env-&gt;addButton(rect&lt;s32&gt;(10, 30, 270, 60), wMainMenu, BUTTON_LAN_MODE, dataManager.GetSysString(1200));  
添加checkbox
chkHostPrepReady[i] = env-&gt;addCheckBox(false, rect&lt;s32&gt;(250, 75 + i * 25, 270, 95 + i * 25), wHostPrepare, CHECKBOX_HP_READY, L&#34;&#34;);

初始化这些元素时都有一个参数是id,当GUI元素被操作的时候这些id就代表了不同的信号.
</code></pre></div><p><strong>如何使用GUI</strong></p>
<p>需要一个对象来接受这些信号,从而使这些GUI元素发挥作用.在irrlicht里,这个对象被称为EventReceiver.</p>
<p>同一时刻,一个device只能有一个EventReceiver.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>这行程序为device设置了一个EventReceiver
device-&gt;setEventReceiver(&amp;menuHandler);
</code></pre></div><p>任意一个类,只要重写了OnEvent(const irr::SEvent& event)方法,就可以成为EventReceiver</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>声明
class MenuHandler: public irr::IEventReceiver {        
public:
	virtual bool OnEvent(const irr::SEvent&amp; event);
};

实现
bool MenuHandler::OnEvent(const irr::SEvent&amp; event) {
    switch(event.EventType){ //获取event类型
    case irr::EET_GUI_EVENT:               //GUI事件
        //根据id判断是哪个GUI元素,然后做出相应操作
        s32 id = event.GUIEvent.Caller-&gt;getID();
       
    case irr::EET_MOUSE_INPUT_EVENT:    //鼠标输入事件
    case irr::EET_KEY_INPUT_EVENT:      //键盘输入事件
        //判断哪个健被按下
        switch(event.KeyInput.Key) 
    }

}

</code></pre></div><h3 id=sqlite>sqlite</h3>
<p>ygopro使用sqlite把所有卡片的信息存储在cards.cdb这个文件中.可以使用<a href=https://sqlitebrowser.org/>sqlitebrowser</a>来方便的操作这个文件.</p>
<p>cards.cdb中有两个表,datas和texts
datas的内容是卡片的信息(用数字表示),texts的内容是跟卡片有关的字符串.</p>
<p>datas的表头如下:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>ot</th>
<th>alias</th>
<th>setcode</th>
<th>type</th>
<th>atk</th>
<th>def</th>
<th>level</th>
<th>race</th>
<th>attribute</th>
<th>category</th>
</tr>
</thead>
</table>
<p>需注意:这些数值的用途大部分是在卡组构造界面搜索卡片</p>
<ul>
<li>id :表示卡片的官方代码</li>
<li>ot :表示卡片的限制情况 0代表禁止 3代表无限制</li>
<li>alias:表示别名,有些卡片被科乐美复刻了多次,比如青眼白龙,复刻后的青眼白龙的alias就是初版青眼白龙的id</li>
<li>setcode :一个10进制数,表示卡片所属的字段,把这个数转换成16进制可得到字段, 每个字段4位16进制数.strings.conf文件中存储了所有字段</li>
</ul>
<p>举个例子:数据库中查到的setcode最大值的卡片是"希望皇 拟声乌托邦",所属字段是"刷拉拉(0x8f)" &ldquo;我我我(0x54)&rdquo; &ldquo;隆隆隆(0x59)&rdquo; &ldquo;怒怒怒(0x82)",这张卡片的setcode是36592129229979791,
转换成16进制是82 0059 0054 008F</p>
<ul>
<li>type :一个10进制数,转换成2进制后,表示卡片类型.</li>
<li>atk :攻击力</li>
<li>def:防御力</li>
<li>level: 等级 or 阶级 or link值</li>
<li>race:种族</li>
<li>attribute:属性</li>
<li>category:一个10进制数,转换成32bit的二进制数,恰好对应卡片搜索的中的32个效果.</li>
</ul>
<p>举个例子:随机选择了一张卡"暗之支配者-佐克&rdquo;,其category值为134217730,写成二进制是00001000000000000000000000000010,倒着看,恰好对应第二个效果"怪兽破坏"和倒数第五个效果"幸运",</p>
<p>至于为什么要倒着看,因为代码中是通过下面的方式设置过滤选项的</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>long long filter = 0x1;
for(int i = 0; i &lt; 32; ++i, filter &lt;&lt;= 1)
    if(mainGame-&gt;chkCategory[i]-&gt;isChecked())
        filter_effect |= filter;	
</code></pre></div><p>texts的内容比较简单 就不展开了.</p>
<h2 id=网络部分>网络部分</h2>
<p>当一个玩家点击"新建主机"时,会同时建立一个server和client,server会立即开始监听,然后client会立即连接server,当另一个玩家点击加入游戏时,会建立一个client按照地址和端口去连接server.</p>
<p>当server接收到client的连接后,会新建一个bufferevent建立与client之间的连接</p>
<p>非TAG模式下,第三个以上的玩家再加入游戏就会变成观众.</p>
<h3 id=client给server发送数据>client给server发送数据</h3>
<p>这个操作重载了3个函数</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>static void SendPacketToServer(unsigned char proto);

template&lt;typename ST&gt;
static void SendPacketToServer(unsigned char proto, ST&amp; st);

static void SendBufferToServer(unsigned char proto, void* buffer, size_t len);
</code></pre></div><p>实际上发送的数据有一个固定的格式</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>     16bit             8bit     若干附加内容
1+附加内容的字节数     proto      

</code></pre></div><h3 id=server接收到数据后>server接收到数据后</h3>
<p>首先会根据数据的前两个字节(packet_len)来判断数据数否正确</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>if(len &lt; 2)
    return;
evbuffer_copyout(input, &amp;packet_len, 2);	//将数据的前两位 (包的长度) 复制到 packet_len
if(len &lt; (size_t)packet_len + 2)
    return;
</code></pre></div><p>然后跳过表示packet_len的前两个字节,从第三个字节开始处理</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>void NetServer::HandleCTOSPacket(DuelPlayer* dp, char* data, unsigned int len);
</code></pre></div><p>HandleCTOSPacket函数会根据不同的proto来做出不同的反应,处理过之后会通过下一节的函数来给玩家和观战者发送数据</p>
<h3 id=server给client发送数据>server给client发送数据</h3>
<p>同样重载了3个函数</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>static void SendPacketToPlayer(DuelPlayer* dp, unsigned char proto);

template&lt;typename ST&gt;
static void SendPacketToPlayer(DuelPlayer* dp, unsigned char proto, ST&amp; st) 

static void SendBufferToPlayer(DuelPlayer* dp, unsigned char proto, void* buffer, size_t len);
</code></pre></div><p>发送数据的格式和上文一致</p>
<p>这个函数执行完之后通常需要立即执行</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>static void ReSendToPlayer(DuelPlayer* dp);
</code></pre></div><p>给另一个玩家以及观战者发送相同的数据</p>
<h2 id=client接收到数据后>client接收到数据后</h2>
<p>和server类似,client首先会根据数据的前两个字节(packet_len)来判断数据数否正确</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>if(len &lt; 2)
    return;
evbuffer_copyout(input, &amp;packet_len, 2);  
if(len &lt; (size_t)packet_len + 2)			
    return;
</code></pre></div><p>然后跳过表示packet_len的前两个字节,从第三个字节开始处理</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>void DuelClient::HandleSTOCPacketLan(char* data, unsigned int len);
</code></pre></div><p>HandleSTOCPacketLan函数会通过不同的proto进行让client做出不同的操作</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/ygopro rel=tag title=ygopro>#ygopro#</a>
</div>
<div class=post-nav>
<div class=article-copyright>
<div class=article-copyright-img>
<img src=/img/qq_qrcode.png width=129px height=129px>
<div style=text-align:center>QQ扫一扫交流</div>
</div>
<div class=article-copyright-info>
<p>
<span>声明：</span>ygopro源码分析
</p>
<p>
<span>链接：</span>http://rayrain.xyz/ygopro/
</p>
<p>
<span>作者：</span>rayrain
</p>
<p>
<span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！
</p>
</div>
</div>
<div class=clear></div>
</div>
<div class=reward-qr-info>
<div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div>
<button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');qr.style.display==='none'?qr.style.display='block':qr.style.display='none'">
<span>赏</span>
</button>
<div id=QR style=display:none>
<div id=wechat style=display:inline-block>
<img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay">
<p>微信打赏</p>
</div>
<div id=alipay style=display:inline-block>
<img id=alipay_qr src=/img/ali-pay.png alt=Alipay>
<p>支付宝打赏</p>
</div>
</div>
</div>
<div class=post-nav>
<div class="post-nav-next post-nav-item">
<a href=http://rayrain.xyz/hugo_manual/ rel=next title=hugo相关操作>
<i class="fa fa-chevron-left"></i> hugo相关操作
</a>
</div>
<div class="post-nav-prev post-nav-item">
<a href=http://rayrain.xyz/about.html rel=prev title=关于我>
关于我
<i class="fa fa-chevron-right"></i>
</a>
</div>
</div>
<div id=ucomments></div>
</footer>
</article>
</section>
</div>
</div>
<div class=sidebar-toggle>
<div class=sidebar-toggle-line-wrap>
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside id=sidebar class=sidebar>
<div class=sidebar-inner>
<ul class="sidebar-nav motion-element">
<li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>
文章目录
</li>
<li class=sidebar-nav-overview data-target=site-overview>
站点概览
</li>
</ul>
<section class="site-overview sidebar-panel">
<div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image src=/img/avatar.png alt=rayrain>
<p class=site-author-name itemprop=name>rayrain</p>
<p class="site-description motion-element" itemprop=description>
a righteoux
</p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href=/post/>
<span class=site-state-item-count>2</span>
<span class=site-state-item-name>日志</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/categories/>
<span class=site-state-item-count>2</span>
<span class=site-state-item-name>分类</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/tags/>
<span class=site-state-item-count>8</span>
<span class=site-state-item-name>标签</span>
</a>
</div>
</nav>
<div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline">
<div class=tagcloud-of-blogroll-title>
<i class="fa fa-fw fa-tags"></i>
标签云
</div>
<ul class=tagcloud-of-blogroll-list>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/ygopro>Ygopro</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/lua>Lua</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/markdown>Markdown</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/css>Css</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/emoji>Emoji</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/html>HTML</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/hugo>Hugo</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/text>Text</a>
</li>
</ul>
</div>
</section>
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
<div class=post-toc>
<div class=post-toc-content><nav id=TableOfContents>
<ul>
<li><a href=#1简单介绍>1.简单介绍</a></li>
<li><a href=#2前期准备>2.前期准备</a>
<ul>
<li><a href=#21-下载源码>2.1 下载源码</a></li>
<li><a href=#22-使用visualstudio编译>2.2 使用VisualStudio编译</a></li>
<li><a href=#23-使用vcpkg管理第三方库>2.3 使用vcpkg管理第三方库</a></li>
<li><a href=#24-使用vscode>2.4 使用vscode</a></li>
<li><a href=#25-linux上使用cmakegcc编译>2.5 linux上使用cmake+gcc编译</a></li>
<li><a href=#26-windows上使用cmakemsvc编译>2.6 windows上使用cmake+msvc编译</a></li>
<li><a href=#杂项>杂项</a></li>
<li><a href=#irrlicht>irrlicht</a></li>
<li><a href=#sqlite>sqlite</a></li>
</ul>
</li>
<li><a href=#网络部分>网络部分</a>
<ul>
<li><a href=#client给server发送数据>client给server发送数据</a></li>
<li><a href=#server接收到数据后>server接收到数据后</a></li>
<li><a href=#server给client发送数据>server给client发送数据</a></li>
</ul>
</li>
<li><a href=#client接收到数据后>client接收到数据后</a></li>
</ul>
</nav></div>
</div>
</section>
</div>
</aside>
</div>
</main>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=copyright>
<span class=copyright-year>
&copy; 2010 - 2022
</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>rayrain's blog</span>
</div>
<div class=powered-info>
<span class=powered-by>
Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.91.2</a>
</span>
<span class=separator-line>/</span>
<span class=theme-info>
Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank> NexT
</a>
</span>
</div>
<div class=vistor-info>
</div>
<div class=license-info>
<span class=storage-info>
Storage by
<a href=https://pages.github.com/ style=font-weight:700 target=_blank>Github Pages</a>
</span>
<span class=separator-line>/</span>
<span class=license-num>
<a href=https://pages.github.com/ target=_blank>Xodom</a>
</span>
</div>
</div>
</footer>
<div class=back-to-top>
<i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span>
</div>
</div>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var a=window.navigator.userAgent,b=a.indexOf('MSIE '),c=a.indexOf('Trident/'),d=a.indexOf('Edge/');return b>0||c>0||d>0?-1:1}function getCntViewHeight(){var b=$('#content').height(),a=$(window).height(),c=b>a?b-a:$(document).height()-a;return c}function getScrollbarWidth(){var a=$('<div />').addClass('scrollbar-measure').prependTo('body'),b=a[0],c=b.offsetWidth-b.clientWidth;return a.remove(),c}function registerBackTop(){var b=50,a=$('.back-to-top');$(window).on('scroll',function(){var d,e,f,c,g;a.toggleClass('back-to-top-on',window.pageYOffset>b),d=$(window).scrollTop(),e=getCntViewHeight(),f=d/e,c=Math.round(f*100),g=c>100?100:c,$('#scrollpercent>span').html(g)}),a.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var a='.post-toc',d=$(a),b='.active-current';d.on('activate.bs.scrollspy',function(){var b=$(a+' .active').last();c(),b.addClass('active-current')}).on('clear.bs.scrollspy',c),$('body').scrollspy({target:a});function c(){$(a+' '+b).removeClass(b.substring(1))}}function initAffix(){var a=$('.header-inner').height(),b=parseInt($('.main').css('padding-bottom'),10),c=a+10;$('.sidebar-inner').affix({offset:{top:c,bottom:b}}),$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){var a,b;$(window).on('resize',function(){a&&clearTimeout(a),a=setTimeout(function(){var a=document.body.clientHeight-100;updateTOCHeight(a)},0)}),updateTOCHeight(document.body.clientHeight-100),b=getScrollbarWidth(),$('.post-toc').css('width','calc(100% + '+b+'px)')}function updateTOCHeight(a){a=a||'auto',$('.post-toc').css('max-height',a)}$(function(){var b=$('.header-inner').height()+10,c,d,a,e;$('#sidebar').css({'margin-top':b}).show(),c=parseInt($('#sidebar').css('margin-top')),d=parseInt($('.sidebar-inner').css('height')),a=c+d,e=$('.content-wrap').height(),e<a&&$('.content-wrap').css('min-height',a),$('.site-nav-toggle').on('click',function(){var a=$('.site-nav'),e=$('.toggle'),b='site-nav-on',f='toggle-close',c=a.hasClass(b),g=c?'slideUp':'slideDown',d=c?'removeClass':'addClass';a.stop()[g]('normal',function(){a[d](b),e[d](f)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active'),$(this).next().removeClass('sidebar-nav-active'),$('.'+$(this).next().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)}),$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active'),$(this).prev().removeClass('sidebar-nav-active'),$('.'+$(this).prev().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)})})</script>
<script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$('.post-body').viewer()})</script>
<script src=//cdn.jsdelivr.net/npm/leancloud-storage@4.6.1/dist/av-min.js></script>
<script type=text/javascript>function showTime(d){var b=new AV.Query(d),a=[],c=$(".leancloud_visitors");c.each(function(){a.push($(this).attr("id").trim())}),b.containedIn('url',a),b.find().then(d=>{var e='.leancloud-visitors-count',b,h,f,j,g,i;if(d.length==0){c.find(e).text(0);return}for(b=0;b<d.length;b++)h=d[b],f=h.get('url'),j=h.get('time'),g=document.getElementById(f),$(g).find(e).text(j);for(b=0;b<a.length;b++)f=a[b],g=document.getElementById(f),i=$(g).find(e),i.text()==''&&i.text(0)},a=>{console.log('Query vistors failed: '+a)})}function addCount(d){var b=$(".leancloud_visitors"),a=b.attr('id').trim(),e=b.attr('data-flag-title').trim(),c=new AV.Query('Counter');c.equalTo("url",a),c.find().then(g=>{var f,c,b;g.length>0?(f=g[0],f.increment('time',1),f.save(null,{query:new AV.Query('Counter').equalTo('url',a),fetchWhenSave:!0}).then(b=>{var c=$(document.getElementById(a));c.find('.leancloud-visitors-count').text(b.get('time'))},a=>{console.log('Update vistor failed: '+a)})):(c=new AV.ACL,c.setPublicReadAccess(!0),c.setPublicWriteAccess(!0),b=new d,b.set("title",e),b.set("url",a),b.set("time",1),b.setACL(c),b.save().then(d=>{var c=$(document.getElementById(a));c.find('.leancloud-visitors-count').text(b.get('time'))},a=>{console.log("Save new vistor failed: "+a)}))})}$(function(){AV.init({appId:"",appKey:"",serverURL:""});const a=AV.Object.extend("Counter");$('.leancloud_visitors').length==1?addCount(a):$('.post-title-link').length>1&&showTime(a)})</script>
<script type=text/javascript>(function(){var a=document.createElement('script');a.type='text/javascript',a.async=!0,a.setAttribute('issue-term',"pathname"),a.setAttribute('theme',"github-light"),a.setAttribute('repo',"Reisen1969/Reisen1969.github.io"),a.crossorigin='anonymous',a.src='https://utteranc.es/client.js',document.getElementById('ucomments').appendChild(a)})()</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script>(function(){var a=document.createElement('script'),c=window.location.protocol.split(':')[0],b;c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>